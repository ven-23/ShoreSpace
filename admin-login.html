<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Portal Login - LocaPark</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        overflow: hidden;
        background-color: #dbe9f7;
        background-image: radial-gradient(#ffffff 1px, transparent 1px),
          radial-gradient(#ffffff 1px, #dbe9f7 1px);
        background-size: 20px 20px;
        background-position: 0 0, 10px 10px;
      }

      :root {
        --primary-color: #1a4f8d; /* Deep Campus Blue */
        --primary-dark-color: #153e70; /* Darker Campus Blue for hover */
        --text-dark: #1f2937;
      }

      .text-primary {
        color: var(--primary-color);
      }
      .bg-primary {
        background-color: var(--primary-color);
      }
      .hover\:bg-primary-dark:hover {
        background-color: var(--primary-dark-color);
      }

      /* Main container for the two-column layout */
      .login-container {
        display: flex;
        width: 90%;
        /* CHANGE: Increase Max Width to make the panel much wider */
        max-width: 1350px;
        /* CHANGE: Increase Min Height to make the panel taller */
        min-height: 700px;
        background-color: white;
        border-radius: 1.5rem;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        overflow: hidden;
      }

      /* Left section with image and overlay */
      .left-panel {
        flex: 1;
        position: relative;
        background: linear-gradient(
          135deg,
          rgba(26, 79, 141, 0.85),
          rgba(21, 62, 112, 0.85)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 50%;
      }
      .left-panel img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 1;
        opacity: 0.8;
      }

      /* Right section with the login form */
      .right-panel {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        /* Increased padding for larger forms */
        padding: 5rem 4rem;
        background-color: white;
      }

      .login-form-container {
        width: 100%;
        /* Adjust max width of form fields for the wider panel */
        max-width: 400px;
        text-align: left;
      }

      .main-heading {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--primary-color);
        margin-bottom: 0.25rem;
        line-height: 1.2;
      }
      .sub-heading {
        color: #6b7280;
        font-size: 1rem;
        margin-bottom: 2rem;
        display: block;
      }

      /* Input Focus Style */
      .input-style {
        transition: all 0.2s ease-in-out;
        border: 1px solid #e5e7eb;
        padding: 0.85rem 1.15rem;
        font-size: 1rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }
      .input-style:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(26, 79, 141, 0.3);
        outline: none;
      }

      /* Modernized Button Style */
      .button-style {
        transition: all 0.3s ease-in-out;
        padding: 1rem 1.5rem;
        font-size: 1.125rem;
        font-weight: 700;
        background-image: linear-gradient(
          180deg,
          var(--primary-color),
          var(--primary-dark-color)
        );
        box-shadow: 0 8px 15px rgba(26, 79, 141, 0.4);
        border: none;
      }
      .button-style:hover {
        transform: translateY(-1px);
        background-image: linear-gradient(
          180deg,
          var(--primary-dark-color),
          #1a4f8d
        );
        box-shadow: 0 10px 20px rgba(26, 79, 141, 0.5);
      }

      /* Responsive adjustments */
      @media (max-width: 900px) {
        .login-container {
          flex-direction: column;
          min-height: auto;
          width: 95%;
          max-width: 500px;
        }
        .left-panel {
          height: 200px;
          min-width: 100%;
          padding: 0;
          border-radius: 1.5rem 1.5rem 0 0;
        }
        .right-panel {
          padding: 2.5rem 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="login-container">
      <div class="left-panel">
        <img src="park.jpg" alt="Modern Campus Parking Lot" />
      </div>

      <div class="right-panel">
        <div class="login-form-container">
          <div id="loginSection">
            <h1 class="main-heading">Admin Login</h1>
            <span class="sub-heading">Access the Campus Management Portal</span>

            <form id="adminLoginForm" onsubmit="handleAdminLogin(event)">
              <div class="mb-5">
                <label class="block text-sm font-semibold text-gray-700 mb-2"
                  >Username</label
                >
                <input
                  type="text"
                  id="loginUser"
                  placeholder="Enter your username"
                  class="input-style w-full border rounded-xl"
                  required
                />
              </div>
              <div class="mb-8">
                <label class="block text-sm font-semibold text-gray-700 mb-2"
                  >Password</label
                >
                <input
                  type="password"
                  id="loginPass"
                  placeholder="Enter your password"
                  class="input-style w-full border rounded-xl"
                  required
                />
              </div>
              <button
                type="submit"
                class="button-style w-full text-white rounded-xl"
              >
                Secure Login
              </button>
            </form>

            <p class="mt-6 text-center text-gray-600 text-sm">
              New admin?
              <button
                onclick="toggleForms('register')"
                class="text-primary font-bold hover:underline"
              >
                Create Account
              </button>
            </p>
          </div>

          <div id="registerSection" class="hidden">
            <h1 class="main-heading">Create Admin</h1>
            <span class="sub-heading">Register a new staff account</span>

            <form id="adminRegisterForm" onsubmit="handleRegister(event)">
              <div class="mb-5">
                <label class="block text-sm font-semibold text-gray-700 mb-2"
                  >New Username</label
                >
                <input
                  type="text"
                  id="regUser"
                  placeholder="Choose a username"
                  class="input-style w-full border rounded-xl"
                  required
                />
              </div>
              <div class="mb-8">
                <label class="block text-sm font-semibold text-gray-700 mb-2"
                  >New Password</label
                >
                <input
                  type="password"
                  id="regPass"
                  placeholder="Choose a password"
                  class="input-style w-full border rounded-xl"
                  required
                />
              </div>

              <div class="mb-8">
                <label class="block text-sm font-semibold text-gray-700 mb-2"
                  >Secret Key</label
                >
                <input
                  type="password"
                  id="regKey"
                  placeholder="Enter admin master code"
                  class="input-style w-full border rounded-xl"
                  required
                />
              </div>
              <button
                type="submit"
                class="button-style w-full text-white rounded-xl bg-green-700"
              >
                Register User
              </button>
            </form>

            <p class="mt-6 text-center text-gray-600 text-sm">
              Already have an account?
              <button
                onclick="toggleForms('login')"
                class="text-primary font-bold hover:underline"
              >
                Back to Login
              </button>
            </p>
          </div>

          <p
            id="systemMessage"
            class="mt-6 text-center text-sm font-medium hidden"
          ></p>
        </div>
      </div>
    </div>

    <script>
      // UI Elements
      const loginSection = document.getElementById("loginSection");
      const registerSection = document.getElementById("registerSection");
      const systemMessage = document.getElementById("systemMessage");

      // Toggle between Login and Register views
      function toggleForms(view) {
        systemMessage.classList.add("hidden"); // Hide messages when switching
        if (view === "register") {
          loginSection.classList.add("hidden");
          registerSection.classList.remove("hidden");
        } else {
          registerSection.classList.add("hidden");
          loginSection.classList.remove("hidden");
        }
      }

      // --- LOGIN FUNCTION ---
      function handleAdminLogin(event) {
        event.preventDefault();
        const user = document.getElementById("loginUser").value.trim();
        const pass = document.getElementById("loginPass").value.trim();

        updateMessage("Verifying credentials...", "text-gray-600");

        fetch("login.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username: user, password: pass }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.success) {
              updateMessage(
                "Login Successful! Redirecting...",
                "text-green-600"
              );
              setTimeout(() => (window.location.href = "index.html"), 1000);
            } else {
              updateMessage(data.message, "text-red-600");
            }
          });
      }

      function handleRegister(event) {
        event.preventDefault();

        const user = document.getElementById("regUser").value.trim();
        const pass = document.getElementById("regPass").value.trim();
        const key = document.getElementById("regKey").value.trim(); // <--- Capture the key

        updateMessage("Creating account...", "text-gray-600");

        fetch("register.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          // Include the key in the JSON payload
          body: JSON.stringify({
            username: user,
            password: pass,
            secret_key: key,
          }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.success) {
              updateMessage(
                "Account created! Redirecting...",
                "text-green-600"
              );

              // Clear fields
              document.getElementById("regUser").value = "";
              document.getElementById("regPass").value = "";
              document.getElementById("regKey").value = ""; // Clear key field

              setTimeout(() => {
                toggleForms("login");
                updateMessage(
                  "Please log in with your new account.",
                  "text-primary"
                );
              }, 1500);
            } else {
              updateMessage(data.message, "text-red-600");
            }
          });
      }
      // Helper to show messages
      function updateMessage(msg, colorClass) {
        systemMessage.textContent = msg;
        systemMessage.className = `mt-6 text-center text-sm font-medium ${colorClass}`;
        systemMessage.classList.remove("hidden");
      }
    </script>
  </body>
</html>
